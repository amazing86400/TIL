# 방한 외래관광객 분석



### 학습 목표

- 연도별 관광객 데이터를 가져와 원하는 데이터를 추출할 수 있다.
- 사용자가 입력한 년/월 파일을 불러오는 사용자 함수를 정의할 수 있다.
- 전체 연도 파일을 한 번에 저장할 수 있다.
- 방한 외래관광객 통합 파일을 통해 Insight를 얻을 수 있다.



---



### 라이브러리

```python
import pandas as pd
import numpy as np
from pandas import Series, DataFrame
```

​	pandas와 numpy 라이브러리를 불러온다.



---



### 데이터 가져오기

```python
df = pd.read_excel('./files/kto_202005.xlsx', header = 1, usecols = 'A:G', skipfooter = 4)
df
```

​	우선 2020년 5월로 한국을 방문한 관광객을 알아보겠다. 원하는 자료만 추출하기 위해 엑셀을 먼저 확인한 후, 필요 없는 데이터들은 가져올 때 미리 없애준다. 그래서 header는 1로 설정하고 columns은 A~G까지, 그리고 마지막 4줄은 제거해 줬다.



---



### 데이터 활용하기

```python
df['기준년월'] = '2019-01'
```

​	데이터 구분을 위해 '연도와 월' 컬럼을 추가했다. 



```python
condition = ['아시아주','미주','구주','대양주','아프리카주','기타대륙','교포소계']
df = df[~df['국적'].isin(condition)]
df.reset_index(drop = True)
```

​	그리고 국적 컬럼을 보면 아시아주, 미주, 구주 등 국가명이 아닌 행들이 있었다. 각 주의 총합을 나타낸 행이었는데, 엑셀에서는 유용하지만 프로그래밍에서는 필요 없는 정보기 때문에, 변수에 담아서 빼주었다. 코드는 마스크 기능을 활용한 것이다. 우선 isin을 써줌으로써, 국적 컬럼에서 condition 변수에 담긴 요소가 True인 값을 반환한다. 그리고 다시 df[]로 묶어 DataFrame 형태로 볼 수 있다. 그런데 우리는 그 값이 아닌, condition의 요소가 없는 값을 찾는 것이기 때문에 '~'를 써주었다. '~'은 조건의 반대 값을 반환해 준다. 그리고 condition의 행들이 빠졌기 때문에 인덱스도 다시 설정해 주었다.



```python
condition = ['아시아']*25 + ['아메리카']*5 + ['유럽']*23 + ['오세아니아']*3\
+ ['아프리카']*2 + ['기타대륙'] + ['교포']
df['대륙'] = condition
```

​	위에서 대륙 행을 없앴다면, 이번에는 대륙 컬럼을 추가해 주었다. 각 국가가 속한 대륙을 같은 행에 맞춰 추가해 주었다. 엑셀 파일에서 대륙의 개수를 세서 코드를 만들었다.



```python
df['관광객비율(%)'] = round(df['관광'] / df['계'] * 100, 2)
df.sort_values(by = '관광객비율(%)', ascending=False)
```

​	우리나라 입국자 중 목적이 '관광'인 사람의 비율을 알아보고 싶었다. 그래서 관광을 총 계로 나누고 100을 곱해 비율로 나타냈다. 그리고 보기 좋게 round() 함수로 2자릿수까지 반올림 시켰다. 다음으로 관광객 비율을 기준으로 내림차순으로 정렬하면 관광객 비율이 가장 많은 나라부터 확인을 할 수 있다. 1위는 크로아티아로 75.77%이며, 우크라이나 61.48%, 영국 54.81%로 각각 2, 3위를 차지했다. 물론 입국자 수는 그렇게 많은 편은 아니지만 우리는 여기서 1, 2, 3위 모두 유럽 국가이며, 관광을 주 목적으로 방한한다는 것을 확인할 수 있다.



```python
df['전체관광객비율(%)'] = round(df['관광'] / sum(df['관광']) * 100, 2)
df.sort_index(by='전체관광객비율(%)', ascending=False)
```

​	이번엔 전체 국가별 관광객 차지 비율을 확인할 것이다. 전체 관광객 비율을 구하기 위해서는 각 국가별 관광 값을 관광 전체 값으로 나누고 100을 곱해주면 된다. 그래서 sum() 함수를 활용해 코드를 짰다. 똑같이 전체 관광객 비율을 기준으로 내림차순 해서 데이터를 확인했다. 그랬더니 미국이 49.03%, 필리핀 11.86%, 인도네시아 9.51%로 각각 1, 2, 3위를 차지했다. 1위와 2위의 차이가 상당히 큰 것을 확인할 수 있고, 미국인들이 관광 목적으로 많이 오는 것을 알 수 있다.



---



### 함수 정의하기



```python
def create(yy,mm):
    file_path = './files/kto_{}{}.xlsx'.format(yy,mm)
    df = pd.read_excel(file_path, header = 1, usecols = 'A:G', skipfooter=4)
    df['기준년월'] = '{}-{}'.format(yy,mm)
    
    ignore_list = ['아시아주','미주','구주','대양주','아프리카주','기타대륙','교포소계']
    df = df[~df['국적'].isin(ignore_list)].reset_index(drop = True)
    
    condition = ['아시아']*25 + ['아메리카']*5 + ['유럽']*23 + ['오세아니아']*3\
+ ['아프리카']*2 + ['기타대륙'] + ['교포']
    df['대륙'] = condition
    
    df['관광객비율(%)'] = round(df['관광'] / df['계'] * 100, 2)
    df['전체관광객비율(%)'] = round(df['관광'] / sum(df['관광']) * 100, 2)
    
    return(df)
```

​	지금까지 작업한 과정들을 def()를 통해 함수로 정의할 것이다. 즉, 사용자가 입력하는 날짜의 파일을 불러오는 함수를 만들려고 한다. 함수의 이름을 create라고 하고, 매개변수로는 연도와 월을 받는다. 그리고 pd.read() 함수를 사용해 파일을 불러올 건데, 사용자가 입력한 날짜의 파일을 불러올 것이기 때문에 format() 함수를 사용한 file_path 변수를 만든다. format의 매개변수 yy와 mm을 입력하면 {} 안으로 자동으로 입력되니 파일 경로를 정확히 입력할 수 있을 것이다. 불러올 때 옵션은 위에서 작업한 옵션과 동일하게 입력한다.

​	이다음부터는 작업한 내용과 동일하게 입력한다. 이때 주의할 점은 df['국적'] 마스크 기능 코드에서 마지막에 reset_index() 함수를 넣는 것을 잊지 말자. 다른 위치에 넣게 되면 함수 정의가 안될 수도 있다. 그럴 경우 다른 코드로 함수를 다시 정의해야 한다.



```python
creat(2011,11) # 성공
creat(2017,01) # 오류
```

​	코드를 만들었으면 한번 실행시켜보자. 첫 번째 코드처럼 월(month)이 2글자인(10~12) 월은 데이터를 잘 읽어냈다. 하지만 두 번째 코드처럼 월이 1글자인(1~9) 월은 오류가 났다. 이유는 현재 저장되어 있는 파일의 이름은 모두 6글자이다. 하지만 월이 1글자인 경우 5글자로 인식된다.(ex: 20105) 한번 이 문제를 해결해 보자.



```python
def create(yy, mm):
    mm_str = str(mm).zfill(2)
    file_path = './files/kto_{}{}.xlsx'.format(str(yy),mm_str)
    df = pd.read_excel(file_path, header = 1, usecols = 'A:G', skipfooter = 4)
    
    df['기준년월'] = '{}-{}'.format(str(yy), mm_str)
    ignore_list = ['아시아주','미주','구주','대양주','아프리카주','기타대륙','교포소계']
    df = df[~df['국적'].isin(condition)].reset_index(drop =  True)
    
    condition = ['아시아']*25 + ['아메리카']*5 + ['유럽']*23 + ['오세아니아']*3 + ['아프리카']*2 + ['기타대륙']*1 + ['교포']*1
    df['대륙'] = condition
    
    df['관광객비율(%)'] = round(df['관광'] / df['계'] * 100, 2)
    df['전체관광객비율(%)'] = round(df['관광'] / sum(df['관광']) * 100, 2)
    
    return(df)
```

​	달라진 것은 바로 str 매소드 함수를 사용했다. 우선 매개변수 입력값을 int가 아닌 str로 해주고, zfill() 함수를 통해 빈자리를 0으로 메꿔주면 된다. zfill() 함수는 내가 설정한 숫자만큼 빈자리를 0으로 채워준다. 만약 (3)으로 설정하고 5를 입력하면 '005'로 값을 반환한다. 즉, (2020, 5)를 입력하면 '202005'로 반환을 해서 월이 1글자인 파일들도 불러올 수 있게 되는 것이다. 



---



### 2010년부터 2020년 5월까지 데이터 합치기

```python
df = DataFrame()
for yy in range(2010,2021):
    for mm in range(1,13):
        try:
            temp = creat(yy, mm)
            df = df.append(temp, ignore_index=True)
        except:
            pass
```

​	이제 우리가 만든 함수를 통해 모든 데이터 파일을 가져와 하나의 DataFrame으로 합칠 것이다. 그래서 가장 먼저 하나의 DataFrame을 만들어 준다. 그리고 for문을 통해 연도와 월을 2010년 1월부터 2020년 12월까지 반복문을 돌린다. 다음으로 try/except 구문을 사용할 건데, 이 구문은 파이썬 실행 중 예상치 못한 에러가 발생했을 때 무시하고 코드를 실행하기 위한 문법이다. 실행할 코드를 try문에 작성하고, 에러가 발생할 경우 except구문이 실행된다. 이 코드를 써준 이유는 내가 갖고 있는 파일은 2020년 5월까지 밖에 없어, 5월이 넘어가게 되면 오류가 나오기 때문이다. 즉, 2020년 6월부터 12월까지의 데이터는 존재하지 않기 때문에 pass를 통해 오류를 방지한다. 이렇게 하면 df변수에 모든 데이터가 DataFrame으로 추가될 것이다. df.info()를 했을 때, 1500개의 entries가 나오면 잘된거다. 



```python
df.to_excel('./files/kto_total.xlsx', index=False)
```

​	그리고 df를 엑셀로 저장한다.



---



### Insight

```python
df[df['국적'] == '일본'].sort_values(by = '관광객비율(%)', ascending=False)

df[df['국적'] == '일본'].sort_values(by = '전체관광객비율(%)', ascending=False)
```

​	이제 가장 중요한 Insight를 얻어보겠다. 일본의 경우 관광객 비율로만 봤을 때는 2010~2012년이 매우 높은 비중을 차지한다. 그중 2011년 12월이 98%로 가장 높다. 그리고 가장 최근인 2020년도는 코로나의 영향으로 확실하 낮은 관광객 비율을 보여준다. 그중 5월이 10.9%로 가장 낮다. 

​	전제 관광객 비율을 봤을 때도 역시 2010년~2012년 사이가 가장 많은 비중을 차지한다. 2010년 3월은 54.97%로 정말 많은 관광객이 우리나라에 관광 목적으로 왔다. 전체 비율을 생각했을 때 54.97%라는 거는 엄청난 기록이라고 생각한다. 우리나라를 방문한 전세계 외국인 관광객 중 50% 이상이 일본인이라는 말이다. 그리고 가장 최근인 2020년 5월이 0.74%로 가장 낮다. 10년 동안 엄청난 변화가 있었다는 것을 알 수 있다.
